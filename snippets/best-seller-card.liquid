{%- comment -%}
  Best Seller Product Card Snippet
  
  Parameters:
  - block: The block object containing product settings
  - index: The product index for unique IDs
{%- endcomment -%}

{%- liquid
  assign card_id = 'product-card-' | append: section.id | append: '-' | append: index
  assign has_hover_image = false
  if block.settings.image_hover != blank
    assign has_hover_image = true
  endif
-%}

<article 
  class="best-seller-card tw-group tw-relative"
  id="{{ card_id }}"
  aria-labelledby="{{ card_id }}-title"
>
  <!-- Product Image Container with Border Radius -->
  <a 
    {% comment %} href="{{ block.settings.product_link | default: '#' }}"  {% endcomment %}
    class="product-image-container tw-block tw-relative tw-aspect-square tw-overflow-hidden tw-rounded-lg tw-bg-gray-100"
    aria-label="View {{ block.settings.title }}"
  >
    <!-- Badges Container -->
    <div class="tw-absolute tw-top-3 tw-left-3 tw-right-3 tw-flex tw-justify-between tw-items-start tw-z-10">
      {%- if block.settings.show_best_seller_badge -%}
        <span class="best-seller-badge">
          BEST SELLER
        </span>
      {%- else -%}
        <span></span>
      {%- endif -%}
      
      {%- if block.settings.show_sale_badge -%}
        <span class="sale-badge">
          {{ block.settings.sale_text }}
        </span>
      {%- endif -%}
    </div>
    
    <!-- Primary Image -->
    {%- if block.settings.image != blank -%}
      <img 
        src="{{ block.settings.image | image_url: width: 600 }}"
        srcset="{{ block.settings.image | image_url: width: 300 }} 300w,
                {{ block.settings.image | image_url: width: 450 }} 450w,
                {{ block.settings.image | image_url: width: 600 }} 600w,
                {{ block.settings.image | image_url: width: 710 }} 710w"
        sizes="(max-width: 768px) 50vw, 355px"
        alt="{{ block.settings.title | escape }}"
        loading="lazy"
        width="{{ block.settings.image.width }}"
        height="{{ block.settings.image.height }}"
        class="product-image-primary tw-absolute tw-inset-0 tw-w-full tw-h-full tw-object-cover tw-transition-opacity tw-duration-300 {% if has_hover_image %}group-hover:tw-opacity-0{% endif %}"
      >
    {%- else -%}
      <!-- Placeholder Image -->
      <div class="tw-absolute tw-inset-0 tw-w-full tw-h-full tw-bg-gray-200 tw-flex tw-items-center tw-justify-center">
        <svg class="tw-w-16 tw-h-16 tw-text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z"></path>
        </svg>
      </div>
    {%- endif -%}
    
    <!-- Hover Image (Secondary) -->
    {%- if has_hover_image -%}
      <img 
        src="{{ block.settings.image_hover | image_url: width: 600 }}"
        srcset="{{ block.settings.image_hover | image_url: width: 300 }} 300w,
                {{ block.settings.image_hover | image_url: width: 450 }} 450w,
                {{ block.settings.image_hover | image_url: width: 600 }} 600w,
                {{ block.settings.image_hover | image_url: width: 710 }} 710w"
        sizes="(max-width: 768px) 50vw, 355px"
        alt="{{ block.settings.title | escape }} - alternate view"
        loading="lazy"
        width="{{ block.settings.image_hover.width }}"
        height="{{ block.settings.image_hover.height }}"
        class="product-image-hover tw-absolute tw-inset-0 tw-w-full tw-h-full tw-object-cover tw-opacity-0 tw-transition-opacity tw-duration-300 group-hover:tw-opacity-100"
      >
    {%- endif -%}
  </a>
  
  <!-- Product Info -->
  <div class="product-card-info tw-pt-4 tw-pb-2">
    <!-- Product Title -->
    <h3 id="{{ card_id }}-title" class="product-title">
      <a href="{{ block.settings.product_link | default: '#' }}">
        {{ block.settings.title }}
      </a>
    </h3>
    
    <!-- Star Rating & Reviews -->
    <div class="product-rating">
      <!-- Stars -->
      <div class="stars" role="img" aria-label="{{ block.settings.rating }} out of 5 stars">
        {%- for i in (1..5) -%}
          {%- if i <= block.settings.rating -%}
            <svg viewBox="0 0 20 20" fill="#1f2937">
              <path d="M9.049 2.927c.3-.921 1.603-.921 1.902 0l1.07 3.292a1 1 0 00.95.69h3.462c.969 0 1.371 1.24.588 1.81l-2.8 2.034a1 1 0 00-.364 1.118l1.07 3.292c.3.921-.755 1.688-1.54 1.118l-2.8-2.034a1 1 0 00-1.175 0l-2.8 2.034c-.784.57-1.838-.197-1.539-1.118l1.07-3.292a1 1 0 00-.364-1.118L2.98 8.72c-.783-.57-.38-1.81.588-1.81h3.461a1 1 0 00.951-.69l1.07-3.292z"/>
            </svg>
          {%- else -%}
            <svg viewBox="0 0 20 20" fill="#d1d5db">
              <path d="M9.049 2.927c.3-.921 1.603-.921 1.902 0l1.07 3.292a1 1 0 00.95.69h3.462c.969 0 1.371 1.24.588 1.81l-2.8 2.034a1 1 0 00-.364 1.118l1.07 3.292c.3.921-.755 1.688-1.54 1.118l-2.8-2.034a1 1 0 00-1.175 0l-2.8 2.034c-.784.57-1.838-.197-1.539-1.118l1.07-3.292a1 1 0 00-.364-1.118L2.98 8.72c-.783-.57-.38-1.81.588-1.81h3.461a1 1 0 00.951-.69l1.07-3.292z"/>
            </svg>
          {%- endif -%}
        {%- endfor -%}
      </div>
      
      <!-- Reviews Count -->
      <span class="reviews-count">{{ block.settings.reviews_count }}</span>
    </div>
    
    <!-- Price -->
    <p class="product-price">{{ block.settings.price }}</p>
  </div>
</article>
